---
layout: post
title: static inline in C 
---

inline的作用仅仅是建议编译器做内联开展处理，而不是强制。

内联函数（inline）可以减少CPU的系统开销，并且程序的整体速度将加快，但当内联函数很大时，会有相反的作用，因此一般比较小的函数才使用内联函数。

通常，程序执行时，处理器从内存中读取代码执行。当程序中调用一个函数时，程序跳到存储器中保存函数的位置，开始读取代码执行，执行完后再返回。

为了提高速度，C语言定义了inline函数，告诉编译器把函数代码在编译时直接拷贝到程序中，这样就不用执行时另外读取函数代码。

static函数告诉编译器其他文件看不到这个函数，因此该函数只能在当前文件中被调用。static inline函数只能在当前文件中被调用，同时执行速度快，几个文件中都可以使用同样的函数名。

如下代码：

void main()
{
    int i;
    for(i=0;i<100;i++)
    {
        myprint();
    }
}
void myprint()
{
    printf("ok");
}

上述代码中，在主函数中调用100次myprint函数，意味着这个函数要进栈100次，出栈100次，这样一来我们就打印一个小小的ok就把大量的时间花费在进栈和出栈之上了。我们可以把代码改为：

void main()
{
    int i;
    for(i=0;i<100;i++)
    {
        myprint();
    }
}
static inline void myprint()
{
    printf("ok");
}
此时相当于：
void main()
{
    int i;
    for(i=0;i<100;i++)
    {
        printf("ok");
    }
}

GCC会在其调用内联函数处将其汇编展开编译，而不为这个函数生成独立的汇编编码。以下几种情况除外：
1、函数的地址被使用的时候。如通过函数指针对函数进行了间接调用。这种情况下就不得不为static inline函数生成独立的汇编码，否则它没有自己的地址。
2、函数本身有递归调用自身的行为。

采用内联函数其实是以空间换取时间的做法。
